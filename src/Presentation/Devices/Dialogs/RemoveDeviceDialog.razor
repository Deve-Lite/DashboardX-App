@using Presentation.Utils;
@inject IStringLocalizer<RemoveDeviceDialog> _localizer;
@inject IDeviceService _deviceService;

@inherits BaseDialog

<MudDialog>
    <DialogContent>
        <DialogLoading IsLoading="IsLoading">
            <LoadedContent>
                <MudText>@_localizer["Are you sure you want to remove this device?"]</MudText>
                <MudText>@_localizer["Name:"] @Device.Name</MudText>
                <MudText>@_localizer["Placing:"] @Device.Placing</MudText>
            </LoadedContent>
        </DialogLoading>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" 
                   Disabled="IsLoading">
            @_localizer["Cancel"]
        </MudButton>
        <MudButton OnClick="RemoveAsync" 
                   Disabled="IsLoading"
                   ButtonType="ButtonType.Submit"
                   Variant="Variant.Filled"
                   Color="Color.Error">
                   @_localizer["Remove"] 
        </MudButton>
    </DialogActions>
</MudDialog>

@code
{
    [Parameter]
    public Device Device { get; set; } = new();
    [Parameter]
    public string ClientId { get; set; } = string.Empty;

    private async Task RemoveAsync()
    {

        if (string.IsNullOrEmpty(Device.Id))
            return;

        if (IsLoading)
            return;

        IsLoading = true;

        var result = await _deviceService.RemoveDevice(ClientId, Device.Id);

        var success = RequestHelpers.InvokeAfterRequest(_snackbar, result, _localizer["Successfully removed device."]);

        IsLoading = false;

        if (!success)
            return;

        Dialog!.Close(DialogResult.Ok(result));
    }
}
