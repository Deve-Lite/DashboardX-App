@using Presentation.Utils;
@inherits BaseControl

@inject IStringLocalizer<ButtonControl> _localizer;

<MudButton Class="p-0 m-0 w-100 h-100 bg-transparent" OnClick="ActionAsync">
    <MudCard Elevation="1"
             Class="container container-fit-content p-0 m-0 w-100 h-100"
             Style="@($"border: 1px solid {GetBorderBackgroundColor()}; border-radius: 1rem; background-color: {GetBackgroundColor()};")">
        <MudGrid Class="p-0 m-0 w-100 h-100 d-flex flex-column">

            <MudItem xs="12" Class="pl-3 pr-3 m-0 pt-4 pb-3 d-flex justify-content-center align-items-center">
                <MudIcon Icon="@IconUtils.GetIcon(Control?.Icon?.Name!)" Size="Size.Large" />
            </MudItem>

            <MudItem xs="12" Class="p-1 d-flex justify-content-center align-items-center hide-overlapping-text">
                <MudText Typo="Typo.body1">
                    @GetName()
                </MudText>
            </MudItem>
        </MudGrid>
    </MudCard>
</MudButton>

@code
{
    #pragma warning disable CS0108
    public async Task ActionAsync()
    {
        if (!Control!.IsAvailable)
        {
            _snackbar.Add(_localizer["Hey, this control is currently off!"]);
            return;
        }

        if (!await ConfirmationDialog())
            return;

        var topic = Control!.GetTopic(Device!);

        await Client!.PublishAsync(topic, Control?.Attributes?.Payload!, Control!.QualityOfService);
    }
}

