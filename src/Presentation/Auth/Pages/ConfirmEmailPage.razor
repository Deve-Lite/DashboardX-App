@page "/auth/confirm/"
@using Presentation.Utils;
@attribute [AllowAnonymous]

@inject IStringLocalizer<ConfirmEmailPage> _localizer

@inherits BaseAuthPage

<PageLoading>
    <LoadedContent>
    </LoadedContent>
</PageLoading>

@code
{
    [Parameter]
    public string Token { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        Token = UrlUtils.GetParamFromCurrentUrl(NavigationManager, "token");

        if (LoadingService.IsLoading)
            return;

        LoadingService.ShowLoading();

        if (!string.IsNullOrEmpty(Token))
        {
            var confirmResult = await AuthenticationService.ConfirmEmail(Token);

            if (confirmResult.Succeeded)
               Snackbar.Add(_localizer["Successfully confirmed email."], Severity.Success);
            else
               Snackbar.Add(_localizer["Filed to confirm email."], Severity.Error);
            
        }

        LoadingService.HideLoading();

        NavigationManager.NavigateTo("/auth/login");


        //TODO: If fail button to resend email else move to login page
    }
}
